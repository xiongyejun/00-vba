# 三.正则元字符----字符表示法 #

人类自然语言所用字符极其丰富多样,我们已经知道正则表达式是用元字符及它们的组合来描述这些字符以及这些字符组成的特定结构的.需要指出的是,正则没有统一标准,它是分流派的.在不同语言平台上(或同语言平台而版本不同),正则元字符的多少往往不同,同一元字符的特性也可能存在一定的差异.正是这个原因,在你参考各种正则资料的时候,尤其要注意这个问题.前面已经阐明,目前VBA平台上,用的是VBScript提供的正则对象,执行的是ECMA-262所规定的标准.

VBscript提供的元字符可方便地描述ASCII码表中的字符集.ASCII码表基本上包括了英文语系所用的所有字符.(如果你不熟悉,可以上网查查,大体上了解有哪些字符).也支持代码点不超过四位十六进制数的Unicode表的字符集.这解决了包括汉字在内的世界各国的官方文字的表示问题.为方便用户在不同环境下使用,同一字符往往有多种等价表示方法.

下面是对表示字符的元字符及序列的分类介绍:

## (一)对于一些常用的不可打印字符,规定了专用的元字符序列 ##

用正则表达式来描述一段字符串,即使它是看不见的,也必须毫无遗漏地表示出来.比如,空格,空白字符和一些不可打印字符,所以,在元字符(序列)中都有它们的表示方法.

	AscII(10进制)	ASCII(16进制)	解释		元字符
	10				0A		换行符		\n
	13				0D		回车符		\r
	12				0C		换页符		\f
	9				09		水平制表符	\t
	11				0B		垂直制表符	\v

## (二)普通字符组:肯定字符组[a-z]及否定字符组[^a-z] ##

肯定字符组表示方括号内列出的任意一个字符.否定字符组是在左方括号后紧跟着一个脱字符”^”,表示匹配括号内未列出的任一字符.例:

- [a-zA-Z]:表示26个英文字母中任意一个（包括大小写），同样意义，如果Ignorecase为true，可简记为[a-z]
- [a-zA-Z0-9_]:表示英文单词字符之一，于\w等价
- [c-f中国]:匹配“中”或“国”或“c-f”中任意一个字符，注意并不是匹配“中国”这个词组
- [^a-zA-Z0-9_]:否定字符组，匹配除了英文单词字符外的任意一个字符，与\W等价
- [^ieou]:否定字符组，匹配除了i,e,o,u外的任意一个字符

第[1-5]组：可以匹配：“第1组，第2组……第5组”

gr[ae]y:可以匹配单词：gray和grey

""[^""]+""：可以匹配引号及引号内的内容

讨论:

1. 如果字符范围在ASCII码表或Unicode字符表中是连续分布的,可以只用起止字符表示范围,中间用”-“连接.
1. 用”-“连接的字符范围,前面必须是起点字符,如不能把[a-z]写为[z-a]
1. 字符组内的字符顺序无关紧要,如[^ieou]与[^eiuo]是一个意思.
1. 如果”-“字符中最左或最右位置,它表示匹配字面字符”-“.如[ieou-]
1. 如果”^”没有紧跟在”[“之后,它也只表示字面字符”^”.

## (三)字符组缩略表示法 ##

对于一些常用的字符类,正则提供了简略表示法:

- \w:任意一个英文单词字符，包括A-Z,a-z,0-9,_
- \d:任意一个英文数字（半角），包括0-9
- \s:任意一个不可见字符，包括\n,\r,\t,\v,\f和空格，但不包含空白字符，即ASCII为0的字符
- \W:任意一个非英文单词字符，除了A-Za-z_外的所有字符
- \D:任意一个非英文数字字符，除了0-9的所有字符
- \S:任意一个非不可见字符，即除了\n,\r,\t,\v,\f和空格的所有字符

提示:肯定类字符缩略表示法,只能表示ASCII码表中的字符,而该表中的否定元字符序列,它们可以匹配文本中unicode字符.

实例:

正则表达式:\W\W\s\w\w\w

它表示匹配一个非单词字符,紧跟又是一个非单词字符,再是一个空格,最后连续三个单词字符.可以匹配:”正则 ABC”,”规则 1_3”等.

## (四)几乎能匹配任何字符的元字符:英文句点 ##

英文点号”.”可以匹配除换行符(\n)外的任意字符之一.它不限于ASCII码表中的字符,只要能显示于电脑上的字符都能匹配.在VBA中,英文句点等价于[^\n].

## (五)控制字符表示法:\cChar ##

在ASCII码表中,十进制代码为1-26的字符全是控制字符,可以用”\c”连接字母A-Z之一来表示.即\cA-\cZ分别表示代码为1-26的控制字符.如”\cM”,表示回车符.

## (六)ASCII码表中字符的八进制转义表示法:\num ##

VBscript正则可用字符的八进制编码转义来表示ASCII字符:它的序列由反斜线和字符的八进制编码组成.例:

	字符		十进制	八进制	正则表达式
	换行符	10		12		\12
	A		65		101		\101

提示:八进制转义法表示字符范围:\0--\377,包括ASCII码表和扩展表中的256个字符.该表示法主要用于难以输入的字符.

## (七)ASCII码表中字符的十六进制转义表示法: \xnum   ##

一个小写的\X后跟两个大写十六进制数字可以匹配ASCII字符集中的一个字符.

	字符	16进制	正则表达式
	空额	20	\x20
	Z	5A	\x5A

提示:可匹配范围\x00--\xFF,但一般用\x00--\x7F表示ASCII字符集中的前128个字符.\x80-\xFF(ASCII扩展码表字符),一般用Unicode代码点表示法替代.

## (八)Unicode码表中字符的十六进制转义表示法:\unum ##

Unicode码一般用称之为代码点来表示一个字符.它是一个十六进制数.

正则表达式中,用“\u”序列后面紧跟字符unicode代码点(十六进制数)表示该字符.

例:

	字符			代码点（16进制）	正则表达式
	A			U+0041			\u0041
	中			U+4e2d			\u4e2d
	所有汉字之一（大陆）	U+4e00---U+9fff		[\u4e00-\u9fff]或[一-龥]

提示:

1.\unum表示法可表示代码点在U+0000--U+FFFF范围内的unicode字符.Unicode本身在发展中,已经出现超过4位的代码点,VBscript正则是不支持,但它们是很难遇到的字符.

	Set rng = rng.Offset(0, 1)
    rng.Value = sub_mh.SubMatches(0)

2.用字符组[…]表示Unicode字符范围时,也可直接用表中起点字面字符与终点字面字符表示.比如大陆中文字符在Unicode表中,起始代码点是U+4e00,是表示中文字符”一”,终点代码点U+9fff,该代码点未定义,而”龥”字在终点附近,所以我们也可以用”[一-龥]”表示所有中文字之一.顺便提示一点,汉字在Unicode中的分布,基本无规律.不要想像"一",后面就是"二"等等.

3.有些流派的正则可以用Unicode的属性来方便表示不同类别的汉字或其它语言文字,但VBscript 5.5是不支持的.

## (九)元字符字面字符表示法:转义符”\” ##

正则表达式用了一部分字符作为元字符,那么怎样在正则表达式中表示这些元字符的字面字符呢?它提供了一个称为转义元字符,即反斜杠来表示.例:表示字面点号可用”\.”;表示反斜杠的字面字符,用”\\”表示.下面列举了如果匹配字面字符必须转义的元字符:

$ ( ) * + . ? [ \ ^ { |

提示:

1.注意并没有包括”]”,”-“,和”}”;

2.普通字符组[…]内部,元字符的转义有自己的规则,在下一章专门介绍.

例:正则表达式:

\d\.\d

可以匹配0.2,3.1….等小数.

## (十)引用前面括号捕获的文本－－反向引用   ##

正则中，用形如\1,\2…的元字符序列表示前面捕获性括号内的字串(块),”\1”叫反向引用.如:
(abc)\1

可以匹配目标文本:abcabc,这里\1实际引用的是它左边括号中的内容”abc”.

(abc)(defg)\2

可以匹配目标文本:abcdefgdefg ,这里\2指的是从左至右第二个括号中的内容.

实例:删除一段英文中重复的单词.

  目标文本:This this Is is an example.

  结果文本:this is an example

         正则表达式: (\w+)\s+\1

  代码:

	Sub testrep()
	    Dim reg, s$
	    s = "This this is Is an exmapl"
	    Set reg =CreateObject("vbscript.regexp")
	    reg.Pattern = "(\w+)\s+\1"
	    reg.Global = True
	    reg.IgnoreCase = True
	    s = reg.Replace(s, "$1")
	    MsgBox s
	End Sub

讨论:

正则表达式中,”\w+”表示匹配连续出现的单词字符.在本例中,它会匹配至空格为止;”\s+”匹配一个或多个空格; “\1”它会匹配左边第一个出现的括号中的相同内容.所以,该正则会匹配诸如”1 1” “1111    1111”之类的文本.

代码中Global属性设置为True,表示搜索所有匹配;IgnoreCase属性设置为True,表示忽略大小写,如”this” 与”THIS”视为同一单词.

代码使用了正则对象的Repalce方法,用$1替换找到的匹配. 这个例中,共找到两个匹配”This this”与”Is is”;而$1在前面已经说过它保存的是第一个捕获性括号内的内容.在本例中分别是This与Is.最终通过替换实现了删除重复单词的目的.

在VBA中使用反向引用要注意:

1.是表示八进制转义的字符还是反向引用?

细心朋友已经发现,反向引用与字符的八制转义表示法,其结构是一样的.那么怎样区分它们呢?其规则是:

“\num”:假如num是一个可以看作八进制的数字.

如果num的值大于正则左前边捕获性括号个数,那么,它是一个八进制转义符;

如果num的值小于或等于正则左前边捕获性括号个数,那么,它是一个反向引用;

显然,如果它左前边没有捕获性括号,那么,它肯定是一个八进制转义符了.如果num数字中含有超过8,或9的数字,那么,它一定是反向引用.

2.\1,\2,…编号是根据前面”左半圆括号”从左至右出现的顺序确定的.
